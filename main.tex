\documentclass[UTF8,openany,AutoFakeBold,zihao=-4,screen]{ctexbook}
% ↑ 打印前去除screen选项，以应用奇偶页不对称（装订线5mm）的排版效果

\makeatletter
\newif\ifscreen
\@ifclasswith{ctexbook}{screen}{\screentrue}{\screenfalse}
\makeatother

\ifscreen
    \usepackage[a4paper,left=2.25cm,right=2.25cm,top=2.5cm,bottom=2.5cm]{geometry}
\else
    \usepackage[a4paper,left=2.5cm,right=2cm,top=2.5cm,bottom=2.5cm,twoside]{geometry}
\fi

\makeatletter
\def\emptypage@emptypage{%
    \hbox{}%
     \vspace*{\fill}
     \begin{center}
        % 打印前请去除documentclass的screen选项，去除后将不再显示此文字
        \ifscreen{\small（此页为空白页）}\fi
     \end{center}
     \vspace{\fill}
     \newpage%
}%
\def\cleardoublepage{%
        \clearpage%
        \if@twoside%
            \ifodd\c@page%
                % do nothing
            \else%
                \emptypage@emptypage%
            \fi%
        \fi%
    }%
\makeatother

\usepackage{algorithmic}
\usepackage[ruled,linesnumbered,vlined]{algorithm2e}
\usepackage{subcaption}
\usepackage{url}
\usepackage{calc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{bm}
\usepackage{amsfonts}
\usepackage{enumerate}
\usepackage{fancyhdr}
\usepackage[super,square,sort,compress]{natbib}
\usepackage{multirow,booktabs,makecell}
\usepackage{graphicx}
\usepackage{datetime2}
\usepackage[font=small,labelsep=space]{caption} %五号，宋体/Time new roman
%\renewcommand{\thetable}{\arabic{table}} %表格和图片编号不分章节，直接1，2，3 ...
%\renewcommand{\thefigure}{\arabic{figure}}
\renewcommand{\theequation}{\arabic{chapter}.\arabic{equation}} %公式标签 章.公式（均为阿拉伯数字）

\ifscreen
    \usepackage[colorlinks,allcolors=violet]{hyperref}
\else
    \usepackage[hidelinks]{hyperref}
\fi

\usepackage{enumitem}
\setlist{nosep}
\setlist[1]{leftmargin=3em}

% below: circled footnote symbols
\usepackage{pifont}
\usepackage[perpage,symbol*]{footmisc}
\DefineFNsymbols{circled}{{\ding{192}}{\ding{193}}{\ding{194}}{\ding{195}}{\ding{196}}{\ding{197}}{\ding{198}}{\ding{199}}{\ding{200}}{\ding{201}}}
\setfnsymbol{circled}
% below: normal number size in footnote
\makeatletter
\long\def\@makefntext#1{\noindent{{\@thefnmark}\enskip #1}}
\makeatother

\usepackage{tocloft} %自定义目录，说明中没有明确规定，和WORD自动生成目录格式一致

%“目录”两个字的格式
\renewcommand\cftbeforetoctitleskip{0pt}
\renewcommand\cftaftertoctitleskip{0pt}
\renewcommand\cfttoctitlefont{\bfseries\heiti\zihao{2}}

% below: toc styles

\cftsetpnumwidth{1em}

\renewcommand\cftchapfont{\heiti\small}
\renewcommand\cftchapleader{\cftdotfill{\cftchapdotsep}}
\renewcommand\cftchapdotsep{1}
\setlength{\cftchapnumwidth}{1em}
\renewcommand\cftchappagefont{\songti\small}
\renewcommand\cftbeforechapskip{0pt}

\renewcommand\cftsecfont{\songti\small}
\renewcommand\cftsecdotsep{1}
\setlength{\cftsecnumwidth}{1em}
\renewcommand\cftsecpagefont{\songti\small}
\renewcommand\cftsecindent{1em}
\renewcommand\cftbeforesecskip{0pt}

\renewcommand\cftsubsecfont{\songti\small}
\renewcommand\cftsubsecdotsep{1}
\setlength{\cftsubsecnumwidth}{1em}
\renewcommand\cftsubsecpagefont{\songti\small}
\renewcommand\cftsubsecindent{2em}
\renewcommand\cftbeforesubsecskip{0pt}

\renewcommand\cftsubsubsecfont{\songti\small}
\renewcommand\cftsubsubsecdotsep{1}
\setlength{\cftsubsubsecnumwidth}{1em}
\renewcommand\cftsubsubsecpagefont{\songti\small}
\renewcommand\cftsubsubsecindent{3em}
\renewcommand\cftbeforesubsubsecskip{0pt}

\usepackage{titlesec}%自定义章节标题
\ctexset{
    chapter = {
        format={\center \heiti \zihao {3}},
        beforeskip=0pt 
    }
}

\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{3}
%使目录中有三级标题，即subsubsection

% below: section title fonts
\titleformat{\section}{\raggedright\zihao{3}\songti}{\thesection\quad}{0pt}{}
\titleformat{\subsection}{\raggedright\zihao{4}\songti}{\thesubsection\quad}{0pt}{}
\titleformat{\subsubsection}{\raggedright\zihao{-4}\songti}{\thesubsubsection\quad}{0pt}{}

\input{head/CoverHead}
\input{head/ReviewTableHead}

\input{includes}
\input{macros}

\title{}
\author{}
\date{}

\begin{document}

% no page numbers until main content (later)
\pagenumbering{gobble}

% 插入封面
\input{head/cover}
\clearpage

% 插入导师评阅表
\input{head/ReviewTable}
\clearpage

\linespread{1.5}\selectfont
\chapter*{版权声明}
任何收存和保管本论文各种版本的单位和个人，未经本论文作者同意，不得将本论文转借他人，亦不得随意复制、抄录、拍照或以任何方式传播。否则，引起有碍作者著作权之问题，将可能承担法律责任。
\clearpage

\normalsize
\linespread{1.5}\selectfont %小四号，宋体/Time new roman，1.5倍行距
\input{chapters/0_abstract}
\clearpage

\chapter*{目录}
\renewcommand{\contentsname}{}
{\hypersetup{linkcolor=black} \tableofcontents}

% 正文页码从1开始，因此要确保前面是偶数页，不然奇偶页的边距就乱了
\cleardoublepage
\pagenumbering{arabic}
\setcounter{page}{1}

\normalsize
\linespread{1.5}\selectfont %正文，小四号，中文宋体，英文Time new roman，1.5倍行距

% below: page headers and footers

\fancypagestyle{plain} { % \chapter{} resets page style to plain for the first page
	\fancyhf{}
    \chead{\chineseTitleA\chineseTitleB}
	\cfoot{第\thepage{}页}
	\renewcommand{\headrulewidth}{0.7pt}
	\renewcommand{\footrulewidth}{0pt}
}
\fancypagestyle{pku} {
	\fancyhf{}
    \chead{\chineseTitleA\chineseTitleB}
	\cfoot{第\thepage{}页}
	\renewcommand{\headrulewidth}{0.7pt}
	\renewcommand{\footrulewidth}{0pt}
}

\pagestyle{pku}

\input{chapters/1_introduction}
\input{chapters/2_Preliminaries}
\input{chapters/3_Algorithm}
% [ ADD FOLLOWING CHAPTERS HERE ]

\clearpage

\small
\linespread{1}\selectfont %正文，五号，中文宋体，英文Time new roman，1倍行距
\addcontentsline{toc}{chapter}{参考文献}
\bibliographystyle{bib/splncs04}
\bibliography{bib/references,bib/crossrefs}
\clearpage

\linespread{1.5}\selectfont\normalsize %正文，小四号，中文宋体，英文Time new roman，1.5倍行距
\chapter*{致谢}
\addcontentsline{toc}{chapter}{致谢}

\input{chapters/90_ack}
\clearpage

\chapter*{北京大学学位论文原创性声明和使用授权说明}
\addcontentsline{toc}{chapter}{北京大学学位论文原创性声明和使用授权说明}
\input{head/honor}
\thispagestyle{empty}

\end{document}
